(()=>{"use strict";var e={};function r(e,r){const o=[],t=(n,s)=>{if(s.length===r)return void o.push(s.slice(0));const a=e.length-(r-s.length)+1;for(let r=n;r<a;r++)s.push(e[r]),t(r+1,s),s.pop()};return t(0,[]),console.log(o.length,"combine length"),o}function o(e,r,o){var t;const n=new Map;for(const a of[...e,...r]){const e=null!==(t=n.get(a))&&void 0!==t?t:0;n.set(a,e+1)}const s=o.map(e=>Object.assign({},e));for(const a of s){let o=null;for(const e of r)if(o=a.charas.find(r=>r.prefabId===e),o)break;const t=a.fixedBorrowChara;if(t&&o&&o.prefabId!=t.prefabId)return[!1,[]];if(o){const e=n.get(o.prefabId);if(e>0&&!a.borrowChara){a.borrowChara=o,n.set(o.prefabId,e-1);continue}}if(t){a.borrowChara=t;const r=n.get(t.prefabId);if(r>0){for(const o of a.charas)if(e.includes(o.prefabId)&&o.prefabId==t.prefabId){n.set(t.prefabId,r-1);break}continue}}}for(const a of s){if(a.borrowChara)continue;let r=null,o=0;for(const t of a.charas)e.includes(t.prefabId)&&n.get(t.prefabId)>0&&(r=t,o++);if(1==o){a.borrowChara=r;const e=n.get(r.prefabId);n.set(r.prefabId,e-1)}}for(const a of s){let r=null;for(const o of e)if(r=a.charas.find(e=>e.prefabId===o),r){const e=n.get(o);if(e>0&&!a.borrowChara){a.borrowChara=r,n.set(o,e-1);break}}}return[[...n.values()].every(e=>0===e),s]}e.d=(r,o)=>{for(var t in o)e.o(o,t)&&!e.o(r,t)&&Object.defineProperty(r,t,{enumerable:!0,get:o[t]})},e.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r);const t=(e,r)=>{const o=[];for(const t of r)e.findIndex(e=>e.prefabId===t.prefabId)>-1&&o.push(t.prefabId);return o},n=(e,r)=>e.reduce((e,o)=>r.includes(o.id)?e+1:e,0);function s(e,r,s,a){const f=[[],[],[],[]];for(const d of e){const e=new Set,a=[],c=[];for(const r of d)for(const o of r.charas){const r=e.size;c.push(o),e.add(o.prefabId),r===e.size&&a.push(o.prefabId)}const i=t(c,r),[u,b]=o(a,i,d);u&&f[n(b,s)].push(b)}const c=f.map(e=>function(e,r){const o={1:{1:1.2,2:1.2,3:1.3,4:1.4,5:1.5},2:{1:1.6,2:1.6,3:1.8,4:1.9,5:2},3:{1:2,2:2,3:2.4,4:2.4,5:2.6},4:{1:3.5,2:3.5,3:3.7,4:3.8,5:4},5:{1:3.5,2:3.5,3:3.7,4:3.8,5:4},6:{1:3.5,2:3.5,3:3.7,4:3.8,5:4}};return e.sort((e,r)=>{let[t,n]=[0,0];return e.forEach(e=>{t+=e.damage*o[e.stage][e.index]}),r.forEach(e=>{n+=e.damage*o[e.stage][e.index]}),n-t}),e}(e));return c.reverse(),c.reduce((e,r)=>e.concat(r),[])}addEventListener("message",({data:e})=>{console.log("start");const o=(({bossList:e,usedList:o,removedList:t,unHaveCharas:n})=>{if(!e.length)return[];const a=(new Date).getTime(),f=function(e,r){const o=[];return e.forEach(e=>{e.tasks.forEach(t=>{(function(e,r){return!!r.includes(e.id)})(t,r)||1==t.type||o.push(Object.assign({bossId:e.id,prefabId:e.prefabId,index:e.index},t))})}),o}(e,t);let c=r(f,3),d=s(c,n,o);d.length||(c=r(f,2),d=s(c,n,o)),d.length||(c=r(f,1),d=s(c,n,o));const i=(new Date).getTime();return console.log((i-a)/1e3),d})(e);postMessage(o)})})();