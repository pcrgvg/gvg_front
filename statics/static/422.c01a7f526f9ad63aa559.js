!function(){"use strict";var r=function(){return(r=Object.assign||function(r){for(var e,n=1,t=arguments.length;n<t;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(r[a]=e[a]);return r}).apply(this,arguments)};function e(r){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&r[e],t=0;if(n)return n.call(r);if(r&&"number"==typeof r.length)return{next:function(){return r&&t>=r.length&&(r=void 0),{value:r&&r[t++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function n(r,e){var n="function"==typeof Symbol&&r[Symbol.iterator];if(!n)return r;var t,a,o=n.call(r),l=[];try{for(;(void 0===e||e-- >0)&&!(t=o.next()).done;)l.push(t.value)}catch(f){a={error:f}}finally{try{t&&!t.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return l}function t(r,e,n){if(n||2===arguments.length)for(var t,a=0,o=e.length;a<o;a++)!t&&a in e||(t||(t=Array.prototype.slice.call(e,0,a)),t[a]=e[a]);return r.concat(t||e)}function a(r,e){var n=[],t=function(a,o){if(o.length!==e)for(var l=r.length-(e-o.length)+1,f=a;f<l;f++)o.push(r[f]),t(f+1,o),o.pop();else n.push(o.slice(0))};return t(0,[]),console.log(n.length,"combine length"),n}function o(r,a,o){var l,f,i,u,c,d,v,h,y,s,b,p,g,x,w,I,m,C=new Map;try{for(var k=e(t(t([],n(r)),n(a))),E=k.next();!E.done;E=k.next()){var S=E.value,O=null!==(m=C.get(S))&&void 0!==m?m:0;C.set(S,O+1)}}catch($){l={error:$}}finally{try{E&&!E.done&&(f=k.return)&&f.call(k)}finally{if(l)throw l.error}}var j=o.map(function(r){return Object.assign({},r)});try{for(var L=e(j),T=L.next();!T.done;T=L.next()){var z=T.value,D=null,M=function(r){if(D=z.charas.find(function(e){return e.prefabId===r}))return"break"};try{for(var A=(c=void 0,e(a)),B=A.next();!B.done&&"break"!==M(B.value);B=A.next());}catch(_){c={error:_}}finally{try{B&&!B.done&&(d=A.return)&&d.call(A)}finally{if(c)throw c.error}}var H=z.fixedBorrowChara;if(H&&D&&D.prefabId!=H.prefabId)return[!1,[]];if(D&&(O=C.get(D.prefabId))>0&&!z.borrowChara)z.borrowChara=D,C.set(D.prefabId,O-1);else if(H&&(z.borrowChara=H,(O=C.get(H.prefabId))>0))try{for(var P=(v=void 0,e(z.charas)),q=P.next();!q.done;q=P.next())if(r.includes((R=q.value).prefabId)&&R.prefabId==H.prefabId){C.set(H.prefabId,O-1);break}}catch(rr){v={error:rr}}finally{try{q&&!q.done&&(h=P.return)&&h.call(P)}finally{if(v)throw v.error}}}}catch(er){i={error:er}}finally{try{T&&!T.done&&(u=L.return)&&u.call(L)}finally{if(i)throw i.error}}try{for(var F=e(j),G=F.next();!G.done;G=F.next())if(!(z=G.value).borrowChara){var J=null,K=0;try{for(var N=(b=void 0,e(z.charas)),Q=N.next();!Q.done;Q=N.next()){var R;r.includes((R=Q.value).prefabId)&&(O=C.get(R.prefabId))>0&&(J=R,K++)}}catch(nr){b={error:nr}}finally{try{Q&&!Q.done&&(p=N.return)&&p.call(N)}finally{if(b)throw b.error}}1==K&&(z.borrowChara=J,O=C.get(J.prefabId),C.set(J.prefabId,O-1))}}catch(tr){y={error:tr}}finally{try{G&&!G.done&&(s=F.return)&&s.call(F)}finally{if(y)throw y.error}}try{for(var U=e(j),V=U.next();!V.done;V=U.next()){z=V.value;var W=null,X=function(r){if(W=z.charas.find(function(e){return e.prefabId===r})){var e=C.get(r);if(e>0&&!z.borrowChara)return z.borrowChara=W,C.set(r,e-1),"break"}};try{for(var Y=(w=void 0,e(r)),Z=Y.next();!Z.done&&"break"!==X(Z.value);Z=Y.next());}catch(ar){w={error:ar}}finally{try{Z&&!Z.done&&(I=Y.return)&&I.call(Y)}finally{if(w)throw w.error}}}}catch(or){g={error:or}}finally{try{V&&!V.done&&(x=U.return)&&x.call(U)}finally{if(g)throw g.error}}return[t([],n(C.values())).every(function(r){return 0===r}),j]}var l=function(r,n){var t,a,o=[],l=function(e){r.findIndex(function(r){return r.prefabId===e.prefabId})>-1&&o.push(e.prefabId)};try{for(var f=e(n),i=f.next();!i.done;i=f.next())l(i.value)}catch(u){t={error:u}}finally{try{i&&!i.done&&(a=f.return)&&a.call(f)}finally{if(t)throw t.error}}return o},f=function(r,e){return r.reduce(function(r,n){return e.includes(n.id)?r+1:r},0)};function i(r,t,a,i){var u,c,d,v,h,y,s=[[],[],[],[]];try{for(var b=e(r),p=b.next();!p.done;p=b.next()){var g=p.value,x=new Set,w=[],I=[];try{for(var m=(d=void 0,e(g)),C=m.next();!C.done;C=m.next()){var k=C.value;try{for(var E=(h=void 0,e(k.charas)),S=E.next();!S.done;S=E.next()){var O=S.value,j=x.size;I.push(O),x.add(O.prefabId),j===x.size&&w.push(O.prefabId)}}catch(D){h={error:D}}finally{try{S&&!S.done&&(y=E.return)&&y.call(E)}finally{if(h)throw h.error}}}}catch(M){d={error:M}}finally{try{C&&!C.done&&(v=m.return)&&v.call(m)}finally{if(d)throw d.error}}var L=n(o(w,l(I,t),g),2),T=L[1];L[0]&&s[f(T,a)].push(T)}}catch(A){u={error:A}}finally{try{p&&!p.done&&(c=b.return)&&c.call(b)}finally{if(u)throw u.error}}var z=s.map(function(r){return t={1:{1:1.2,2:1.2,3:1.3,4:1.4,5:1.5},2:{1:1.6,2:1.6,3:1.8,4:1.9,5:2},3:{1:2,2:2,3:2.4,4:2.4,5:2.6},4:{1:3.5,2:3.5,3:3.7,4:3.8,5:4},5:{1:3.5,2:3.5,3:3.7,4:3.8,5:4},6:{1:3.5,2:3.5,3:3.7,4:3.8,5:4}},(e=r).sort(function(r,e){var a=n([0,0],2),o=a[0],l=a[1];return r.forEach(function(r){o+=r.damage*t[r.stage][r.index]}),e.forEach(function(r){l+=r.damage*t[r.stage][r.index]}),l-o}),e;var e,t});return z.reverse(),z.reduce(function(r,e){return r.concat(e)},[])}addEventListener("message",function(e){var n=e.data;console.log("start");var t=function(e){var n=e.bossList,t=e.usedList,o=e.removedList,l=e.unHaveCharas;if(!n.length)return[];var f=(new Date).getTime(),u=function(e,n){var t=[];return e.forEach(function(e){e.tasks.forEach(function(a){(function(r,e){return!!e.includes(r.id)})(a,n)||1==a.type||t.push(r({bossId:e.id,prefabId:e.prefabId,index:e.index},a))})}),t}(n,o),c=a(u,3),d=i(c,l,t);d.length||(d=i(c=a(u,2),l,t)),d.length||(d=i(c=a(u,1),l,t));var v=(new Date).getTime();return console.log((v-f)/1e3),d}(n);postMessage(t)})}();