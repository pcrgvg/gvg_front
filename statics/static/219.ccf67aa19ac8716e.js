!function(){"use strict";function z(r,n){(null==n||n>r.length)&&(n=r.length);for(var e=0,a=new Array(n);e<n;e++)a[e]=r[e];return a}function F(r,n){if(r){if("string"==typeof r)return z(r,n);var e=Object.prototype.toString.call(r).slice(8,-1);if("Object"===e&&r.constructor&&(e=r.constructor.name),"Map"===e||"Set"===e)return Array.from(r);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return z(r,n)}}function R(r,n){return function X(r){if(Array.isArray(r))return r}(r)||function Y(r,n){var e=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=e){var l,f,a=[],t=!0,o=!1;try{for(e=e.call(r);!(t=(l=e.next()).done)&&(a.push(l.value),!n||a.length!==n);t=!0);}catch(u){o=!0,f=u}finally{try{!t&&null!=e.return&&e.return()}finally{if(o)throw f}}return a}}(r,n)||F(r,n)||function Z(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(r,n){var e="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!e){if(Array.isArray(r)||(e=F(r))||n&&r&&"number"==typeof r.length){e&&(r=e);var a=0,t=function(){};return{s:t,n:function(){return a>=r.length?{done:!0}:{done:!1,value:r[a++]}},e:function(i){throw i},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,o=!0,l=!1;return{s:function(){e=e.call(r)},n:function(){var i=e.next();return o=i.done,i},e:function(i){l=!0,f=i},f:function(){try{!o&&null!=e.return&&e.return()}finally{if(l)throw f}}}}function J(r){return function B(r){if(Array.isArray(r))return z(r)}(r)||function _(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||F(r)||function C(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function N(r,n){var e=[];return function o(l,f){if(f.length!==n)for(var i=r.length-(n-f.length)+1,v=l;v<i;v++)f.push(r[v]),o(v+1,f),f.pop();else e.push(f.slice(0))}(0,[]),console.log(e.length,"combine length"),e}function nr(r,n,e){for(var a,t=new Map,o=0,l=[].concat(J(r),J(n));o<l.length;o++){var f=l[o],u=null!==(a=t.get(f))&&void 0!==a?a:0;t.set(f,u+1)}var b,i=e.map(function(c){return Object.assign({},c)}),v=s(i);try{for(v.s();!(b=v.n()).done;){var A,p=b.value,y=null,m=s(n);try{var w=function(){var T=A.value;if(y=p.charas.find(function(k){return k.prefabId===T}))return"break"};for(m.s();!(A=m.n()).done&&"break"!==w(););}catch(c){m.e(c)}finally{m.f()}var h=p.fixedBorrowChara;if(h&&y&&y.prefabId!=h.prefabId)return[!1,[]];if(y){var j=t.get(y.prefabId);if(j>0&&!p.borrowChara){p.borrowChara=y,t.set(y.prefabId,j-1);continue}}if(h){p.borrowChara=h;var E=t.get(h.prefabId);if(E>0){var L,I=s(p.charas);try{for(I.s();!(L=I.n()).done;){var O=L.value;if(r.includes(O.prefabId)&&O.prefabId==h.prefabId){t.set(h.prefabId,E-1);break}}}catch(c){I.e(c)}finally{I.f()}continue}}}}catch(c){v.e(c)}finally{v.f()}var U,g=s(i);try{for(g.s();!(U=g.n()).done;){var d=U.value;if(!d.borrowChara){var K,S=null,H=0,x=s(d.charas);try{for(x.s();!(K=x.n()).done;){var $=K.value;r.includes($.prefabId)&&t.get($.prefabId)>0&&(S=$,H++)}}catch(c){x.e(c)}finally{x.f()}if(1==H){d.borrowChara=S;var ur=t.get(S.prefabId);t.set(S.prefabId,ur-1)}}}}catch(c){g.e(c)}finally{g.f()}var Q,D=s(i);try{for(D.s();!(Q=D.n()).done;){var V,q=Q.value,G=null,M=s(r);try{var lr=function(){var T=V.value;if(G=q.charas.find(function(dr){return dr.prefabId===T})){var k=t.get(T);if(k>0&&!q.borrowChara)return q.borrowChara=G,t.set(T,k-1),"break"}};for(M.s();!(V=M.n()).done&&"break"!==lr(););}catch(c){M.e(c)}finally{M.f()}}}catch(c){D.e(c)}finally{D.f()}return[J(t.values()).every(function(c){return 0===c}),i]}var tr=function(n,e){var o,a=[],t=s(e);try{var l=function(){var u=o.value;n.findIndex(function(i){return i.prefabId===u.prefabId})>-1&&a.push(u.prefabId)};for(t.s();!(o=t.n()).done;)l()}catch(f){t.e(f)}finally{t.f()}return a},ar=function(n,e){return n.reduce(function(a,t){return e.includes(t.id)?a+1:a},0)};function W(r,n,e,a){var l,t=[[],[],[],[]],o=s(r);try{for(o.s();!(l=o.n()).done;){var p,f=l.value,u=new Set,i=[],v=[],b=s(f);try{for(b.s();!(p=b.n()).done;){var A,m=s(p.value.charas);try{for(m.s();!(A=m.n()).done;){var w=A.value,P=u.size;v.push(w),u.add(w.prefabId),P===u.size&&i.push(w.prefabId)}}catch(d){m.e(d)}finally{m.f()}}}catch(d){b.e(d)}finally{b.f()}var E=R(nr(i,tr(v,n),f),2),L=E[1];E[0]&&t[ar(L,e)].push(L)}}catch(d){o.e(d)}finally{o.f()}var g=t.map(function(d){return function fr(r,n){var e={1:{1:1.2,2:1.2,3:1.3,4:1.4,5:1.5},2:{1:1.6,2:1.6,3:1.8,4:1.9,5:2},3:{1:2,2:2,3:2.4,4:2.4,5:2.6},4:{1:3.5,2:3.5,3:3.7,4:3.8,5:4},5:{1:3.5,2:3.5,3:3.7,4:3.8,5:4},6:{1:3.5,2:3.5,3:3.7,4:3.8,5:4}};return r.sort(function(a,t){var o=0,l=0;return a.forEach(function(f){o+=f.damage*e[f.stage][f.index]}),t.forEach(function(f){l+=f.damage*e[f.stage][f.index]}),l-o}),r}(d)});return g.reverse(),g.reduce(function(d,S){return d.concat(S)},[])}addEventListener("message",function(r){var n=r.data;console.log("start");var e=function(n){var e=n.bossList,a=n.usedList,t=n.removedList,o=n.unHaveCharas;if(!e.length)return[];var f=(new Date).getTime(),u=function rr(r,n){var e=[];return r.forEach(function(a){a.tasks.forEach(function(t){!function er(r,n){return!!n.includes(r.id)}(t,n)&&1!=t.type&&e.push(Object.assign({bossId:a.id,prefabId:a.prefabId,index:a.index},t))})}),e}(e,t),i=N(u,3),v=W(i,o,a);v.length||(v=W(i=N(u,2),o,a)),v.length||(v=W(i=N(u,1),o,a));var b=(new Date).getTime();return console.log((b-f)/1e3),v}(n);postMessage(e)})}();