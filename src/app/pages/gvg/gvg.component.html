<div style="max-width: 700px; margin: 0 auto;">
  <div class="header">
    <div class="heder-left">
      <mat-select [(ngModel)]="serverType" (ngModelChange)="getGvgTaskList()" style="width: 80px;">
        <mat-option *ngFor="let server of serverOption" [value]="server.value">{{ server.label }} </mat-option>
      </mat-select>
      <mat-select [(ngModel)]="stage" (ngModelChange)="getGvgTaskList()" style="width: 80px;">
        <mat-option *ngFor="let stage of stageOption" [value]="stage.value"> 阶段{{ stage.value }} </mat-option>
      </mat-select>
      <!-- <button mat-button (clickStop)="getGvgTaskList()">查询</button> -->
    </div>
    <div>
      <button *ngIf="operate" mat-button (clickStop)="toggleModal()">添加作业</button>
      <button mat-button (clickStop)="openUnHaveModal()">添加未拥有box</button>
      <mat-select [(ngModel)]="onlyAuto" (ngModelChange)="toggleAuto()" style="width: 80px;">
        <mat-option [value]="false"> 全部 </mat-option>
        <mat-option [value]="true"> 自动 </mat-option>
      </mat-select>
      <button mat-button (clickStop)="filter()">筛刀</button>
      <button mat-button (clickStop)="openInstructions()">说明</button>
      <!-- <button mat-button (clickStop)="filter()">sh</button> -->
    </div>
  </div>
  <div class="content">
    <div>
      <h3>未持有角色</h3>
      <app-pcr-icon
        *ngFor="let chara of unHaveChara; trackBy: trackByCharaFn"
        [rarity]="chara.rarity"
        [prefabId]="chara.prefabId"
      ></app-pcr-icon>
    </div>
    <mat-accordion multi>
      <mat-expansion-panel *ngFor="let boss of filterBossList; index as i; trackBy: trackByBossFn">
        <mat-expansion-panel-header>
          <mat-panel-title style="align-items: center;">
            <mat-checkbox style="margin-right: 15px;" [checked]="boss.checked" (clickStop)="boss.checked = !boss.checked"></mat-checkbox>
            <app-pcr-icon [prefabId]="boss.prefabId"> </app-pcr-icon>
          </mat-panel-title>
          <mat-panel-description>{{ boss.unitName }}</mat-panel-description>
        </mat-expansion-panel-header>

        <mat-accordion>
          <mat-expansion-panel *ngFor="let task of boss.tasks">
            <mat-expansion-panel-header style="height: 96px;">
              <mat-panel-title>
                <div class="g-flex" style="margin-right: 2px;" *ngFor="let chara of task.charas; trackBy: trackByCharaFn">
                  <app-pcr-icon [rarity]="chara.rarity" [prefabId]="chara.prefabId"></app-pcr-icon>
                  <div class="chara-info">
                    <div class="g-flex"><img style="width: 6px; height: 6px;" src="/assets/images/star.png" /> {{ chara.rarity }}</div>
                    <span>{{ chara.rank }}</span>
                  </div>
                </div>
              </mat-panel-title>
              <mat-panel-description style="align-items: center;">
                <span>{{ task.canAuto | canauto }} </span>
                <button mat-button color="primary" (clickStop)="task.isUsed = !task.isUsed">{{ task.isUsed ? '已使用' : '未使用' }}</button>
                <button mat-button color="warn" (clickStop)="task.disabeld = !task.disabeld">{{ task.disabeld ? '加入' : '去除' }}</button>
                <button mat-button color="warn" *ngIf="operate" (clickStop)="toggleModal(task, boss.id)">修改</button>
                <app-loading-button *ngIf="operate" [loading]="loading" (clickStop)="delelteTask(boss, task)">删除</app-loading-button>
              </mat-panel-description>
            </mat-expansion-panel-header>
            <div>伤害:{{ task.damage }}w</div>
            <div>
              <div>
                <span>视频:</span>
                <a style="padding: 0 5px;" *ngFor="let item of task.links; index as i" [href]="item.link" target="_blank">{{
                  item.name || '链接' + i
                }}</a>
              </div>
            </div>
            <pre>备注: {{ task.remarks }}</pre>
          </mat-expansion-panel>
        </mat-accordion>
      </mat-expansion-panel>
    </mat-accordion>
  </div>
</div>
